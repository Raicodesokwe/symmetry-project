# Firestore Database Schema - Flutter Project

## Collections

### Articles Collection (`articles`)

Stores news articles for the Flutter application.

#### Schema Structure
```dart
class Article {
  final String id;
  final String title;
  final String content;
  final String newsImageUrl;
  final DateTime publishedAt;
  final DateTime? createdAt;
  final DateTime? updatedAt;

  Article({
    required this.id,
    required this.title,
    required this.content,
    required this.newsImageUrl,
    required this.publishedAt,
    this.createdAt,
    this.updatedAt,
  });
}
```

#### Firestore Document Structure
```javascript
{
  id: string,                    // Document ID (auto-generated or custom)
  title: string,                 // Article title
  content: string,               // Article content/body (supports HTML/Markdown)
  news_image_url: string,        // Firebase Storage download URL for the article's thumbnail image
  published_at: timestamp,       // Publication date and time
  created_at: timestamp,         // Document creation timestamp (optional)
  updated_at: timestamp          // Last update timestamp (optional)
}
```

#### Field Descriptions

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `id` | `string` | Yes | Unique identifier for the article. Auto-generated by Firestore or custom string. |
| `title` | `string` | Yes | The headline/title of the news article. |
| `content` | `string` | Yes | Full article content. Can contain HTML or Markdown formatting. |
| `news_image_url` | `string` | Yes | Firebase Storage download URL for the article's thumbnail image. Generated after uploading to `article_images/` bucket. Format: `https://firebasestorage.googleapis.com/v0/b/...` |
| `published_at` | `timestamp` | Yes | Timestamp indicating when the article was published. |
| `created_at` | `timestamp` | No | Timestamp for when the document was created in Firestore. |
| `updated_at` | `timestamp` | No | Timestamp for the last update to the document. |

---

## Security Rules


### Firestore Security Rules

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Articles collection - Public read/write (NO AUTH)
    match /articles/{articleId} {
      // Allow anyone to read articles
      allow read: if true;
      
      // Allow anyone to create/update/delete
      allow create, update, delete: if true;
      
      // Validate data structure on write
      allow write: if request.resource.data.title is string 
        && request.resource.data.title.size() > 0
        && request.resource.data.title.size() < 200
        && request.resource.data.content is string
        && request.resource.data.content.size() > 0
        && request.resource.data.content.size() < 50000  // Max 50KB content
        && request.resource.data.news_image_url is string
        && request.resource.data.news_image_url.matches('https?://.*')
        && request.resource.data.published_at is timestamp;
    }
  }
}
```

**Completely open (for testing):**
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;
    }
  }
}
```

### Firebase Storage Security Rules

Update your Firebase Storage security rules in the Firebase Console:
```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    
    // Article images bucket - Public read/write (NO AUTH)
    match /article_images/{imageId} {
      // Allow anyone to read images
      allow read: if true;
      
      // Allow anyone to upload images
      allow create: if request.resource.size < 5 * 1024 * 1024  // Max 5MB
                    && request.resource.contentType.matches('image/.*');
    
    }
    
    // Deny everything else
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
```

**Completely open (for testing):**
```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /{allPaths=**} {
      allow read, write: if true;
    }
  }
}
```

### Storage Structure
```
gs://your-project.appspot.com/
└── article_images/
    ├── article_id_1_timestamp.jpg
    ├── article_id_2_timestamp.png
    └── article_id_3_timestamp.jpg
```

---

Last Updated: October 22, 2025
Version: 1.0.0